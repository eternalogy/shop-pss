<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.vin.pss.provider.dao.PurchaseDao">
  <resultMap id="BaseResultMap" type="com.vin.pss.provider.model.Purchase">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="product_id" jdbcType="INTEGER" property="productId" />
    <result column="purchase_date" jdbcType="DATE" property="purchaseDate" />
    <result column="pro_date" jdbcType="DATE" property="proDate" />
    <result column="exp_date" jdbcType="DATE" property="expDate" />
    <result column="purchase_price" jdbcType="DECIMAL" property="purchasePrice" />
    <result column="purchase_count" jdbcType="INTEGER" property="purchaseCount" />
    <result column="purchase_amount" jdbcType="DECIMAL" property="purchaseAmount" />
    <result column="receipt_img" jdbcType="VARCHAR" property="receiptImg" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="deleted" jdbcType="BIT" property="deleted" />
    <collection property="suppliers" ofType="com.vin.pss.provider.model.Supplier">
      <id column="id" property="id"/>
      <result column="supplier_name" property="supplierName"/>
    </collection>
    <collection property="products" ofType="com.vin.pss.provider.model.Product">
      <id column="id" property="id"/>
      <result column="product_name" property="productName"/>
      <result column="bar_code" property="barCode"/>
    </collection>
    <collection property="categories" ofType="com.vin.pss.provider.model.Category">
      <id column="id" property="id"/>
      <result column="category_name" property="categoryName"/>
    </collection>
  </resultMap>
  <sql id="Base_Column_List">
    id, product_id, purchase_date, pro_date, exp_date, purchase_price, purchase_count,
    purchase_amount, receipt_img, create_time, update_time, deleted
  </sql>
  <select id="selectAll" resultMap="BaseResultMap">
    SELECT
	*
FROM
	biz_product product,
	biz_supplier s,
	biz_purchase purchase,
	biz_category c
WHERE
	product.deleted = 0
AND s.deleted = 0
AND purchase.deleted = 0
AND c.deleted = 0
AND product.category_id = c.id
AND product.supplier_id = s.id
AND product.id = purchase.product_id
  </select>
  <select id="selectByProductName" parameterType="string" resultMap="BaseResultMap">
    SELECT
	*
FROM
	biz_product product,
	biz_supplier s,
	biz_purchase purchase,
	biz_category c
WHERE
	product.deleted = 0
AND s.deleted = 0
AND purchase.deleted = 0
AND c.deleted = 0
AND product.category_id = c.id
AND product.supplier_id = s.id
AND product.id = purchase.product_id
AND product.product_name LIKE concat('%',#{productName},'%')
  </select>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from biz_purchase
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    delete from biz_purchase
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" keyColumn="id" keyProperty="id" parameterType="com.vin.pss.provider.model.Purchase" useGeneratedKeys="true">
    insert into biz_purchase (product_id, purchase_date, pro_date,
      exp_date, purchase_price, purchase_count,
      purchase_amount, receipt_img, create_time,
      update_time, deleted)
    values (#{productId,jdbcType=INTEGER}, #{purchaseDate,jdbcType=DATE}, #{proDate,jdbcType=DATE},
      #{expDate,jdbcType=DATE}, #{purchasePrice,jdbcType=DECIMAL}, #{purchaseCount,jdbcType=INTEGER},
      #{purchaseAmount,jdbcType=DECIMAL}, null, now(),
      now(), 0)
  </insert>
  <insert id="insertSelective" keyColumn="id" keyProperty="id" parameterType="com.vin.pss.provider.model.Purchase" useGeneratedKeys="true">
    insert into biz_purchase
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="productId != null">
        product_id,
      </if>
      <if test="purchaseDate != null">
        purchase_date,
      </if>
      <if test="proDate != null">
        pro_date,
      </if>
      <if test="expDate != null">
        exp_date,
      </if>
      <if test="purchasePrice != null">
        purchase_price,
      </if>
      <if test="purchaseCount != null">
        purchase_count,
      </if>
      <if test="purchaseAmount != null">
        purchase_amount,
      </if>
      <if test="receiptImg != null">
        receipt_img,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="updateTime != null">
        update_time,
      </if>
      <if test="deleted != null">
        deleted,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="productId != null">
        #{productId,jdbcType=INTEGER},
      </if>
      <if test="purchaseDate != null">
        #{purchaseDate,jdbcType=DATE},
      </if>
      <if test="proDate != null">
        #{proDate,jdbcType=DATE},
      </if>
      <if test="expDate != null">
        #{expDate,jdbcType=DATE},
      </if>
      <if test="purchasePrice != null">
        #{purchasePrice,jdbcType=DECIMAL},
      </if>
      <if test="purchaseCount != null">
        #{purchaseCount,jdbcType=INTEGER},
      </if>
      <if test="purchaseAmount != null">
        #{purchaseAmount,jdbcType=DECIMAL},
      </if>
      <if test="receiptImg != null">
        #{receiptImg,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null">
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="deleted != null">
        #{deleted,jdbcType=BIT},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.vin.pss.provider.model.Purchase">
    update biz_purchase
    <set>
      <if test="productId != null">
        product_id = #{productId,jdbcType=INTEGER},
      </if>
      <if test="purchaseDate != null">
        purchase_date = #{purchaseDate,jdbcType=DATE},
      </if>
      <if test="proDate != null">
        pro_date = #{proDate,jdbcType=DATE},
      </if>
      <if test="expDate != null">
        exp_date = #{expDate,jdbcType=DATE},
      </if>
      <if test="purchasePrice != null">
        purchase_price = #{purchasePrice,jdbcType=DECIMAL},
      </if>
      <if test="purchaseCount != null">
        purchase_count = #{purchaseCount,jdbcType=INTEGER},
      </if>
      <if test="purchaseAmount != null">
        purchase_amount = #{purchaseAmount,jdbcType=DECIMAL},
      </if>
      <if test="receiptImg != null">
        receipt_img = #{receiptImg,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null">
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="deleted != null">
        deleted = #{deleted,jdbcType=BIT},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.vin.pss.provider.model.Purchase">
    update biz_purchase
    set product_id = #{productId,jdbcType=INTEGER},
      purchase_date = #{purchaseDate,jdbcType=DATE},
      pro_date = #{proDate,jdbcType=DATE},
      exp_date = #{expDate,jdbcType=DATE},
      purchase_price = #{purchasePrice,jdbcType=DECIMAL},
      purchase_count = #{purchaseCount,jdbcType=INTEGER},
      purchase_amount = #{purchaseAmount,jdbcType=DECIMAL},
      receipt_img = #{receiptImg,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      update_time = #{updateTime,jdbcType=TIMESTAMP},
      deleted = #{deleted,jdbcType=BIT}
    where id = #{id,jdbcType=INTEGER}
  </update>
</mapper>
